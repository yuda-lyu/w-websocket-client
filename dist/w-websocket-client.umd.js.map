{"version":3,"file":"w-websocket-client.umd.js","sources":["../node_modules/wsemi/src/getGlobal.mjs","../node_modules/wsemi/src/getEnv.mjs","../node_modules/wsemi/src/isfun.mjs","../src/WWebsocketClient.mjs"],"sourcesContent":["/**\r\n * 取得運行環境中的頂層物件\r\n *\r\n * Unit Test: {@link https://github.com/yuda-lyu/wsemi/blob/master/test/getGlobal.test.js Github}\r\n * @memberOf wsemi\r\n * @returns {Object} 回傳頂層物件，若無法取得則回傳null\r\n * @example\r\n * getGlobal()\r\n * // => global object in running environment\r\n */\r\nfunction getGlobal() {\r\n\r\n    if (typeof self !== 'undefined') {\r\n        return self\r\n    }\r\n    if (typeof window !== 'undefined') {\r\n        return window //於borwser的型別為[object Window]\r\n    }\r\n    if (typeof global !== 'undefined') {\r\n        return global //於nodejs的型別為[object global]\r\n    }\r\n\r\n    return null\r\n}\r\n\r\n\r\nexport default getGlobal\r\n","/**\r\n * 取得運行環境\r\n *\r\n * Unit Test: {@link https://github.com/yuda-lyu/wsemi/blob/master/test/getEnv.test.js Github}\r\n * @memberOf wsemi\r\n * @returns {Object} 回傳運行環境物件\r\n * @example\r\n * getEnv()\r\n * // => { isBrowser: false, isWebWorker: false, isNode: true }\r\n */\r\nfunction getEnv() {\r\n\r\n    //isBrowser\r\n    let isBrowser = typeof window !== 'undefined' && typeof window.document !== 'undefined'\r\n\r\n    //isWebWorker\r\n    let isWebWorker = typeof self === 'object' &&\r\n        self.constructor &&\r\n        self.constructor.name === 'DedicatedWorkerGlobalScope'\r\n\r\n    //isNode\r\n    let isNode = typeof process !== 'undefined' &&\r\n        process.versions != null &&\r\n        process.versions.node != null\r\n\r\n    //若在WebWorker也代表在瀏覽器\r\n    isBrowser = isBrowser || isWebWorker\r\n\r\n    //此處沒偵測nodejs的Worker Threads\r\n\r\n    let r = {\r\n        isBrowser,\r\n        isWebWorker,\r\n        isNode\r\n    }\r\n\r\n    return r\r\n}\r\n\r\n\r\nexport default getEnv\r\n","/**\r\n * 判斷是否為函數\r\n *\r\n * Unit Test: {@link https://github.com/yuda-lyu/wsemi/blob/master/test/isfun.test.js Github}\r\n * @memberOf wsemi\r\n * @param {*} v 輸入任意資料\r\n * @returns {Boolean} 回傳判斷布林值\r\n * @example\r\n * isfun('1.25')\r\n * // => false\r\n *\r\n * isfun(function() {})\r\n * // => true\r\n */\r\nfunction isfun(v) {\r\n\r\n    let c = Object.prototype.toString.call(v)\r\n    return c === '[object Function]' || c === '[object AsyncFunction]'\r\n}\r\n\r\n\r\nexport default isfun\r\n","import WS from 'ws'\r\nimport getGlobal from 'wsemi/src/getGlobal.mjs'\r\nimport getEnv from 'wsemi/src/getEnv.mjs'\r\nimport isfun from 'wsemi/src/isfun.mjs'\r\n\r\n\r\n/**\r\n * 建立WebSocket使用者(Node.js與Browser)端物件\r\n *\r\n * @param {Object} opt 輸入設定參數物件\r\n * @param {String} [opt.url='ws://localhost:8080'] 輸入WebSocket伺服器ws網址，預設為'ws://localhost:8080'\r\n * @param {String} [opt.token='*'] 輸入使用者認證用token，預設為'*'\r\n * @param {Function} opt.open 輸入監聽open函數\r\n * @param {Function} opt.close 輸入監聽close函數\r\n * @param {Function} opt.message 輸入監聽message函數\r\n * @param {Function} opt.error 輸入監聽error函數\r\n * @returns {Promise} 回傳Promise，resolve為回傳連接成功的Websocket物件，reject回傳為無法連接\r\n * @example\r\n *\r\n * import WSC from 'w-websocket-client/dist/w-websocket-client.umd.js'\r\n *\r\n * //opt\r\n * let opt = {\r\n *     url: 'ws://localhost:8080',\r\n *     token: '*',\r\n *     open: function() {\r\n *         console.log('client: open')\r\n *     },\r\n *     close: function() {\r\n *         console.log('client: close')\r\n *     },\r\n *     message: function(data) {\r\n *         console.log('client: message', data)\r\n *     },\r\n *     error: function(err) {\r\n *         console.log('client: error:', err)\r\n *     },\r\n * }\r\n *\r\n * //wsc\r\n * let wsc = null\r\n * new WSC(opt)\r\n *     .then(function(w){\r\n *\r\n *         //save\r\n *         wsc = w\r\n *\r\n *         //send\r\n *         let data = 'abc'\r\n *         wsc.send(data)\r\n *\r\n *     })\r\n *\r\n *\r\n */\r\nfunction WWebsocketClient(opt) {\r\n    let wsc = null //WebSocket\r\n\r\n\r\n    //default\r\n    if (!opt.url) {\r\n        opt.url = 'ws://localhost:8080'\r\n    }\r\n    if (!opt.token) {\r\n        opt.token = '*'\r\n    }\r\n\r\n\r\n    //isBrowser\r\n    let isBrowser = getEnv().isBrowser\r\n\r\n\r\n    //MixWS\r\n    let MixWS\r\n    if (isBrowser) {\r\n        MixWS = getGlobal().WebSocket //use browser websocket\r\n    }\r\n    else {\r\n        MixWS = WS //use nodejs ws\r\n    }\r\n\r\n\r\n    //WebSocket, 網址傳token參數作為識別使用者\r\n    try {\r\n        wsc = new MixWS(opt.url + '/' + '?token=' + opt.token)\r\n    }\r\n    catch (err) {\r\n        return null\r\n    }\r\n\r\n\r\n    //bind\r\n    if (isBrowser) {\r\n        wsc.onopen = fOpen\r\n        wsc.onmessage = function(ev) {\r\n            let message = ev.data //瀏覽器端會被包至data\r\n            fMessage(message)\r\n        }\r\n        wsc.onclose = fClose\r\n        wsc.onerror = fError\r\n    }\r\n    else {\r\n        wsc.on('open', fOpen)\r\n        wsc.on('message', fMessage)\r\n        wsc.on('close', fClose)\r\n        wsc.on('error', fError)\r\n    }\r\n\r\n\r\n    //fOpen\r\n    function fOpen() {\r\n        if (isfun(opt.open)) {\r\n            opt.open()\r\n        }\r\n    }\r\n\r\n\r\n    //fClose\r\n    function fClose() {\r\n        if (isfun(opt.close)) {\r\n            opt.close()\r\n        }\r\n    }\r\n\r\n\r\n    //fMessage\r\n    function fMessage(data) {\r\n        if (isfun(opt.message)) {\r\n            opt.message(data)\r\n        }\r\n    }\r\n\r\n\r\n    //fError\r\n    function fError(err) {\r\n        if (isfun(opt.error)) {\r\n            opt.error(err)\r\n        }\r\n        wsc.close()\r\n    }\r\n\r\n\r\n    return wsc\r\n}\r\n\r\n\r\nexport default WWebsocketClient\r\n"],"names":["getGlobal","self","window","global","getEnv","isBrowser","document","isWebWorker","constructor","name","isNode","process","versions","node","r","isfun","v","c","Object","prototype","toString","call","WWebsocketClient","opt","fOpen","open","fClose","close","fMessage","data","message","fError","err","error","wsc","url","token","MixWS","WebSocket","WS","onopen","onmessage","ev","onclose","onerror","on"],"mappings":"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"}