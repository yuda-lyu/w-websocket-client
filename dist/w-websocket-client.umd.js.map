{"version":3,"file":"w-websocket-client.umd.js","sources":["../node_modules/wsemi/src/genPm.mjs","../node_modules/wsemi/src/isfun.mjs","../src/WWebsocketClient.mjs"],"sourcesContent":["/**\r\n * 產生Promise物件，具備鏈式resolve與reject\r\n * 主要受jQuery Deferred概念啟發\r\n *\r\n * Unit Test: {@link https://github.com/yuda-lyu/wsemi/blob/master/test/genPm.test.js Github}\r\n * @memberOf wsemi\r\n * @returns {Object} 回傳Promise物件\r\n * @example\r\n * let fn = function() {\r\n *   let df = genPm()\r\n *   setTimeout(function() {\r\n *     df.resolve()\r\n *   }, 1)\r\n *   return df\r\n * }\r\n * fn()\r\n *   .then(function(){\r\n *     //add code\r\n *   })\r\n */\r\nfunction genPm() {\r\n\r\n    let resolve\r\n    let reject\r\n    let p = new Promise(function() {\r\n        resolve = arguments[0]\r\n        reject = arguments[1]\r\n    })\r\n    p.resolve = resolve\r\n    p.reject = reject\r\n\r\n    return p\r\n}\r\n\r\n\r\nexport default genPm\r\n","/**\r\n * 判斷是否為函數\r\n *\r\n * Unit Test: {@link https://github.com/yuda-lyu/wsemi/blob/master/test/isfun.test.js Github}\r\n * @memberOf wsemi\r\n * @param {*} v 輸入任意資料\r\n * @returns {Boolean} 回傳判斷布林值\r\n * @example\r\n * isfun('1.25')\r\n * // => false\r\n *\r\n * isfun(function() {})\r\n * // => true\r\n */\r\nfunction isfun(v) {\r\n\r\n    let c = Object.prototype.toString.call(v)\r\n    return c === '[object Function]' || c === '[object AsyncFunction]'\r\n}\r\n\r\n\r\nexport default isfun\r\n","import WS from 'ws'\r\nimport genPm from 'wsemi/src/genPm.mjs'\r\nimport isfun from 'wsemi/src/isfun.mjs'\r\n\r\n\r\n/**\r\n * 建立WebSocket使用者(Node.js與Browser)端物件\r\n *\r\n * @param {Object} opt 輸入設定參數物件\r\n * @param {String} [opt.url='ws://localhost:8080'] 輸入WebSocket伺服器ws網址，預設為'ws://localhost:8080'\r\n * @param {String} [opt.token='*'] 輸入使用者認證用token，預設為'*'\r\n * @param {Function} opt.open 輸入監聽open函數\r\n * @param {Function} opt.close 輸入監聽close函數\r\n * @param {Function} opt.message 輸入監聽message函數\r\n * @param {Function} opt.error 輸入監聽error函數\r\n * @returns {Promise} 回傳Promise，resolve為回傳連接成功的Websocket物件，reject回傳為無法連接\r\n * @example\r\n *\r\n * import WSC from 'w-websocket-client/dist/w-websocket-client.umd.js'\r\n *\r\n * //opt\r\n * let opt = {\r\n *     url: 'ws://localhost:8080',\r\n *     token: '*',\r\n *     open: function() {\r\n *         console.log('client: open')\r\n *     },\r\n *     close: function() {\r\n *         console.log('client: close')\r\n *     },\r\n *     message: function(data) {\r\n *         console.log('client: message', data)\r\n *     },\r\n *     error: function(err) {\r\n *         console.log('client: error:', err)\r\n *     },\r\n * }\r\n *\r\n * //wsc\r\n * let wsc = null\r\n * new WSC(opt)\r\n *     .then(function(w){\r\n *\r\n *         //save\r\n *         wsc = w\r\n *\r\n *         //send\r\n *         let data = 'abc'\r\n *         wsc.send(data)\r\n *\r\n *     })\r\n *\r\n *\r\n */\r\nfunction WWebsocketClient(opt) {\r\n    let pm = genPm()\r\n    let wsc = null //WebSocket\r\n\r\n\r\n    //default\r\n    if (!opt.url) {\r\n        opt.url = 'ws://localhost:8080'\r\n    }\r\n    if (!opt.token) {\r\n        opt.token = '*'\r\n    }\r\n\r\n\r\n    //inBrowser\r\n    let inBrowser = typeof window !== 'undefined'\r\n    //console.log('inBrowser', inBrowser)\r\n\r\n\r\n    //MixWS\r\n    let MixWS\r\n    if (inBrowser) {\r\n        MixWS = window.WebSocket //use browser websocket\r\n    }\r\n    else {\r\n        MixWS = WS //use nodejs ws\r\n    }\r\n\r\n\r\n    //WebSocket, 網址傳token參數作為識別使用者\r\n    try {\r\n        wsc = new MixWS(opt.url)\r\n    }\r\n    catch (err) {\r\n        pm.reject('can not create websocket')\r\n        return pm\r\n    }\r\n\r\n\r\n    //bind\r\n    if (inBrowser) {\r\n        wsc.onopen = fOpen\r\n        wsc.onmessage = function(ev) {\r\n            let message = ev.data //瀏覽器端會被包至data\r\n            fMessage(message)\r\n        }\r\n        wsc.onclose = fClose\r\n        wsc.onerror = fError\r\n    }\r\n    else {\r\n        wsc.on('open', fOpen)\r\n        wsc.on('message', fMessage)\r\n        wsc.on('close', fClose)\r\n        wsc.on('error', fError)\r\n    }\r\n\r\n\r\n    //fOpen\r\n    function fOpen() {\r\n        if (isfun(opt.open)) {\r\n            opt.open()\r\n        }\r\n\r\n        //resolve\r\n        pm.resolve(wsc)\r\n\r\n    }\r\n\r\n\r\n    //fClose\r\n    function fClose() {\r\n        if (isfun(opt.close)) {\r\n            opt.close()\r\n        }\r\n    }\r\n\r\n\r\n    //fMessage\r\n    function fMessage(data) {\r\n        if (isfun(opt.message)) {\r\n            opt.message(data)\r\n        }\r\n    }\r\n\r\n\r\n    //fError\r\n    function fError(err) {\r\n        if (isfun(opt.error)) {\r\n            opt.error(err)\r\n        }\r\n        wsc.close()\r\n    }\r\n\r\n\r\n    return pm\r\n}\r\n\r\n\r\nexport default WWebsocketClient\r\n"],"names":["genPm","resolve","reject","p","Promise","arguments","isfun","v","c","Object","prototype","toString","call","WWebsocketClient","opt","fOpen","open","pm","wsc","fClose","close","fMessage","data","message","fError","err","error","url","token","MixWS","inBrowser","window","WebSocket","WS","onopen","onmessage","ev","onclose","onerror","on"],"mappings":";;;;0OAoBA,QAASA,CAAAA,CAAT,EAAiB,IAETC,CAAAA,CAFS,CAGTC,CAHS,CAITC,CAAC,CAAG,GAAIC,CAAAA,OAAJ,CAAY,UAAW,CAC3BH,CAAO,CAAGI,SAAS,CAAC,CAAD,CADQ,CAE3BH,CAAM,CAAGG,SAAS,CAAC,CAAD,CAFd,CAAA,CAJK,OAQbF,CAAAA,CAAC,CAACF,OAAFE,CAAYF,EACZE,CAAC,CAACD,MAAFC,CAAWD,EAEJC,ECjBX,QAASG,CAAAA,CAAT,CAAeC,CAAf,CAAkB,IAEVC,CAAAA,CAAC,CAAGC,MAAM,CAACC,SAAPD,CAAiBE,QAAjBF,CAA0BG,IAA1BH,CAA+BF,CAA/BE,QACK,mBAAND,GAAAA,CAAC,EAAkC,wBAANA,GAAAA,ECqCxC,QAASK,CAAAA,CAAT,CAA0BC,CAA1B,CAA+B,SA0DlBC,CAAAA,GAAQ,CACTT,CAAK,CAACQ,CAAG,CAACE,IAAL,CADI,EAETF,CAAG,CAACE,IAAJF,EAFS,CAMbG,CAAE,CAAChB,OAAHgB,CAAWC,CAAXD,CAhEuB,SAsElBE,CAAAA,GAAS,CACVb,CAAK,CAACQ,CAAG,CAACM,KAAL,CADK,EAEVN,CAAG,CAACM,KAAJN,EAxEmB,SA8ElBO,CAAAA,EAASC,EAAM,CAChBhB,CAAK,CAACQ,CAAG,CAACS,OAAL,CADW,EAEhBT,CAAG,CAACS,OAAJT,CAAYQ,CAAZR,CAhFmB,SAsFlBU,CAAAA,EAAOC,EAAK,CACbnB,CAAK,CAACQ,CAAG,CAACY,KAAL,CADQ,EAEbZ,CAAG,CAACY,KAAJZ,CAAUW,CAAVX,CAFa,CAIjBI,CAAG,CAACE,KAAJF,GA1FuB,GACvBD,CAAAA,CAAE,CAAGjB,CAAK,EADa,CAEvBkB,CAAG,CAAG,IAFiB,CAMtBJ,CAAG,CAACa,GANkB,GAOvBb,CAAG,CAACa,GAAJb,CAAU,qBAPa,EAStBA,CAAG,CAACc,KATkB,GAUvBd,CAAG,CAACc,KAAJd,CAAY,GAVW,KAoBvBe,CAAAA,CApBuB,CAevBC,CAAS,CAAqB,WAAlB,QAAOC,CAAAA,MAfI,CAsBvBF,CAtBuB,CAqBvBC,CArBuB,CAsBfC,MAAM,CAACC,SAtBQ,CAyBfC,CAzBe,IA8BvB,CACAf,CAAG,CAAG,GAAIW,CAAAA,CAAJ,CAAUf,CAAG,CAACa,GAAd,CADV,CAGA,MAAOF,CAAP,CAAY,OACRR,CAAAA,CAAE,CAACf,MAAHe,CAAU,0BAAVA,EACOA,CAnCgB,OAwCvBa,CAAAA,GACAZ,CAAG,CAACgB,MAAJhB,CAAaH,EACbG,CAAG,CAACiB,SAAJjB,CAAgB,SAASkB,CAAT,CAAa,IACrBb,CAAAA,CAAO,CAAGa,CAAE,CAACd,KACjBD,CAAQ,CAACE,CAAD,CAFZ,EAIAL,CAAG,CAACmB,OAAJnB,CAAcC,EACdD,CAAG,CAACoB,OAAJpB,CAAcM,IAGdN,CAAG,CAACqB,EAAJrB,CAAO,MAAPA,CAAeH,CAAfG,EACAA,CAAG,CAACqB,EAAJrB,CAAO,SAAPA,CAAkBG,CAAlBH,EACAA,CAAG,CAACqB,EAAJrB,CAAO,OAAPA,CAAgBC,CAAhBD,EACAA,CAAG,CAACqB,EAAJrB,CAAO,OAAPA,CAAgBM,CAAhBN,GAyCGD"}